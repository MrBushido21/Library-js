<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Админ панель</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f6f7;
      margin: 0;
      padding: 0;
    }
    header {
      background: #333;
      color: #fff;
      padding: 15px;
      text-align: center;
      font-size: 1.4rem;
    }
    main {
      display: flex;
      flex-direction: column;
      gap: 25px;
      padding: 20px;
    }
    section {
      background: #fff;
      border-radius: 10px;
      padding: 15px 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    tr:hover {
      background: #f2f2f2;
    }
    button {
      padding: 6px 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .delete-btn {
      background: #dc3545;
    }
    .delete-btn:hover {
      background: #a71d2a;
    }
    #create-librarian-form {
      display: none;
      margin-top: 15px;
    }
    #books-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
    }
    #books-modal .modal-content {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      width: 400px;
      max-height: 80%;
      overflow-y: auto;
    }
    #books-modal h3 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <header>Панель администратора</header>

  <main>
    <!-- Раздел пользователей -->
    <section>
      <h2>Пользователи</h2>
      <table id="users-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Логин</th>
            <th>Статус</th>
            <th>Книги</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          <!-- сюда JS вставит пользователей -->
        </tbody>
      </table>
    </section>

    <!-- Раздел библиотекарей -->
    <section>
      <h2>Библиотекари</h2>
      <button id="show-create-librarian">Создать библиотекаря</button>

      <form id="create-librarian-form">
        <input type="text" id="lib-login" placeholder="Логин" required />
        <input type="password" id="lib-password" placeholder="Пароль" required />
        <button type="submit">Создать</button>
      </form>

      <table id="librarians-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Логин</th>
            <th>Действие</th>
          </tr>
        </thead>
        <tbody>
          <!-- сюда JS вставит библиотекарей -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- Модалка с книгами -->
  <div id="books-modal">
    <div class="modal-content">
      <h3>Книги пользователя</h3>
      <ul id="books-list"></ul>
      <button onclick="closeBooksModal()">Закрыть</button>
    </div>
  </div>

  <script>
    // ======== Функции работы с API ========
    async function fetchUsers() {
      try {
        const res = await fetch('/api/admin/users'); // TODO: твоя ручка
        const users = await res.json();
        renderUsers(users);
      } catch (e) {
        console.error('Ошибка загрузки пользователей', e);
      }
    }

    async function fetchLibrarians() {
      try {
        const res = await fetch('/api/admin/librarians'); // TODO: твоя ручка
        const librarians = await res.json();
        renderLibrarians(librarians);
      } catch (e) {
        console.error('Ошибка загрузки библиотекарей', e);
      }
    }

    async function toggleBan(userId, isBanned) {
      const action = isBanned ? 'unban' : 'ban';
      await fetch(`/api/admin/users/${userId}/${action}`, {
        method: 'PATCH'
      });
      fetchUsers();
    }

    async function deleteLibrarian(librarianId) {
      await fetch(`/api/admin/librarians/${librarianId}`, {
        method: 'DELETE'
      });
      fetchLibrarians();
    }

    async function createLibrarian(login, password) {
      await fetch('/api/admin/librarians', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ login, password })
      });
      fetchLibrarians();
    }

    async function viewUserBooks(userId) {
      try {
        const res = await fetch(`/api/admin/users/${userId}/books`); // TODO
        const books = await res.json();
        showBooksModal(books);
      } catch (e) {
        console.error('Ошибка получения книг', e);
      }
    }

    // ======== Рендер ========
    function renderUsers(users = []) {
      const tbody = document.querySelector('#users-table tbody');
      tbody.innerHTML = '';
      users.forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${user.id}</td>
          <td>${user.login}</td>
          <td>${user.isBanned ? 'В бане' : 'Активен'}</td>
          <td><button onclick="viewUserBooks(${user.id})">Обзор</button></td>
          <td>
            <button onclick="toggleBan(${user.id}, ${user.isBanned})">
              ${user.isBanned ? 'Разбан' : 'Бан'}
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderLibrarians(libs = []) {
      const tbody = document.querySelector('#librarians-table tbody');
      tbody.innerHTML = '';
      libs.forEach(lib => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${lib.id}</td>
          <td>${lib.login}</td>
          <td>
            <button class="delete-btn" onclick="deleteLibrarian(${lib.id})">Удалить</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ======== Модалка ========
    function showBooksModal(books) {
      const modal = document.getElementById('books-modal');
      const list = document.getElementById('books-list');
      list.innerHTML = '';
      books.forEach(b => {
        const li = document.createElement('li');
        li.textContent = b.title;
        list.appendChild(li);
      });
      modal.style.display = 'flex';
    }

    function closeBooksModal() {
      document.getElementById('books-modal').style.display = 'none';
    }

    // ======== Обработчики ========
    document.getElementById('show-create-librarian').addEventListener('click', () => {
      const form = document.getElementById('create-librarian-form');
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('create-librarian-form').addEventListener('submit', e => {
      e.preventDefault();
      const login = document.getElementById('lib-login').value.trim();
      const password = document.getElementById('lib-password').value.trim();
      if (!login || !password) return alert('Введите логин и пароль!');
      createLibrarian(login, password);
      e.target.reset();
      e.target.style.display = 'none';
    });

    // ======== Инициализация ========
    (async function init() {
      await fetchUsers();
      await fetchLibrarians();
    })();

    // ======== Пример временных данных (можно удалить) ========
    // (раскомментируй, если хочешь протестировать интерфейс без API)
    /*
    renderUsers([
      {id: 1, login: 'user1', isBanned: false},
      {id: 2, login: 'user2', isBanned: true},
    ]);
    renderLibrarians([
      {id: 1, login: 'lib1'},
      {id: 2, login: 'lib2'}
    ]);
    */
  </script>
</body>
</html>
